"use strict";!function(){var C={},t=function(){d3.selectAll(".you-draw-it").each(function(){var r=d3.select(this),n=this.dataset.key,i=window.ydi_data[n],s=i.data,d=Object.keys(s).map(function(t){return{year:Number(t),value:s[t]}});if(C[n]||(C[n]={}),d.length<1)console.log("No data available for:",n);else{var l=window.innerWidth<760,o=d[0].year,c=d[d.length-1].year,p=[{year:i.lastDataPoint,class:"blue",title:""},{year:c,class:"blue",title:"Deine\nEinschÃ¤tzung"}],u=1<p.length?p[p.length-2].year:p[0].year,t=d3.min(d,function(t){return t.value}),e=d3.max(d,function(t){return t.value}),a=[o].concat(p.map(function(t){return t.year})),h=function(){for(var r=arguments,t=0;t<r.length;t++)"string"!=typeof r[t]&&"number"!=typeof r[t]||(r[t]=function(e){return function(t){return t[e]}}(r[t]));return function(t){for(var e=0,a=r.length;e++<a;)t=r[e-1].call(this,t);return t}},f=function(t,e){var a=i.precision?Number(t).toFixed(i.precision):e?Number(t).toFixed(e):t;return String(a).replace(".",",")+(i.unit?" "+i.unit:"")},y=function(t,e){var a=k.x(t),r=k.y(s[t]),n=f(s[t]),i=k.labels.append("div").classed("data-label",!0).classed(e,!0).style("left",a+"px").style("top",r+"px");return i.append("span").text(n),t==o&&l&&i.classed("edge-left",!0),t==c&&l&&i.classed("edge-right",!0),[k.dots.append("circle").attr("r",4.5).attr("cx",a).attr("cy",r).attr("class",e),i]},g=function(t,e,a){return Math.max(t,Math.min(e,a))};r.html("");var x=20,v=l?20:50,m=20,w=l?20:50,b=r.node().offsetWidth,k={width:b-(w+v),height:400-(x+m)},L=Math.min(t,0),D=Math.max(2*s[u],e+.4*(e-L));k.x=d3.scaleLinear().range([0,k.width]),k.x.domain([o,c]),k.y=d3.scaleLinear().range([k.height,0]),k.y.domain([L,D]),k.svg=r.append("svg").attr("width",b).attr("height",400).append("g").attr("transform","translate("+w+","+x+")").attr("width",k.width).attr("height",k.height),k.defs=d3.select(k.svg.node().parentNode).append("defs"),["black","red","blue"].forEach(function(t){var e=k.defs.append("linearGradient").attr("id","gradient-"+t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("class","start"),e.append("stop").attr("offset","100%").attr("class","end")}),k.defs.append("marker").attr("id","preview-arrow").attr("orient","auto").attr("markerWidth",2).attr("markerHeight",4).attr("refX",.1).attr("refY",2).append("path").attr("d","M0,0 V4 L2,2 Z"),k.grid=k.svg.append("g").attr("class","grid"),k.grid.append("g").attr("class","horizontal").call(d3.axisBottom(k.x).tickValues(k.x.ticks(c-o)).tickFormat("").tickSize(k.height)).selectAll("line").attr("class",function(t,e){return-1!==a.indexOf(t)?"highlight":""}),k.grid.append("g").attr("class","vertical").call(d3.axisLeft(k.y).tickValues(k.y.ticks(6)).tickFormat("").tickSize(-k.width));var M=function(t){t.style("left",w+"px").style("top",x+"px").style("width",k.width+"px").style("height",k.height+"px")},S=k.svg.append("rect").attr("class","draggable").attr("x",k.x(u)).attr("width",k.x(c)-k.x(u)).attr("height",k.height).attr("opacity",0);setTimeout(function(){var t=k.svg.node().getBoundingClientRect();k.top=t.top+window.scrollY,k.bottom=t.bottom+window.scrollY},1e3),k.labels=r.append("div").attr("class","labels").call(M),k.axis=k.svg.append("g"),k.charts=k.svg.append("g"),k.preview=k.svg.append("line").attr("class","preview-line").attr("marker-end","url(#preview-arrow)").attr("x1",k.x(u)).attr("y1",k.y(s[u])).attr("x2",k.x(u)+50).attr("y2",k.y(s[u]));var z,A=k.svg.append("path").attr("class","your-line");k.dots=k.svg.append("g").attr("class","dots"),k.xAxis=d3.axisBottom().scale(k.x),k.xAxis.tickFormat(function(t){return"'"+String(t).substr(2)}).ticks(c-o),(z=k).axis.append("g").attr("class","x axis").attr("transform","translate(0,"+z.height+")").call(z.xAxis),L<0&&z.axis.append("g").classed("nullaxis",!0).attr("transform","translate(0,"+z.y(0)+")").call(d3.axisBottom(z.x).tickValues([]).tickSize(0)),z.axis.append("text").text("0").attr("transform","translate(-15, "+(z.y(0)+5)+")"),k.titles=r.append("div").attr("class","titles").call(M),k.controls=r.append("div").attr("class","controls").call(M).style("padding-left",k.x(u)+"px"),k.controls.append("div").attr("class","box").text("Zeichnen Sie die Linie zu Ende");var E=p.map(function(t,e){var a=0<e?p[e-1].year:o,r=t.year;return k.titles.append("span").style("left",k.x(a)+"px").style("width",k.x(r)-k.x(a)+"px").text(t.title),function(a,r,t){var e=function(t,e){return t.year>=a&&t.year<=r},n=d3.area().x(h("year",k.x)).y0(h("value",k.y)).y1(k.height).defined(e),i=d3.area().x(h("year",k.x)).y(h("value",k.y)).defined(e);a==o&&y(o,t);var s=t+(r==u?" median":""),l=k.charts.append("g");return l.append("path").attr("d",n(d)).attr("class","area "+s).attr("fill","url(#gradient-"+t+")"),l.append("path").attr("d",i(d)).attr("class","line "+s),[l].concat(y(r,s))}(a,r,t.class)}),F=E[E.length-1][0],N=k.charts.append("clipPath").attr("id","result-clip-"+n).append("rect").attr("width",k.x(u)).attr("height",k.height),B=E[E.length-1].slice(1,3);F.attr("clip-path","url(#result-clip-"+n+")").append("rect").attr("width",k.width).attr("height",k.height).attr("fill","none"),B.map(function(t){return t.style("opacity",0)});var T=d3.line().x(h("year",k.x)).y(h("value",k.y));C[n].yourData||(C[n].yourData=d.map(function(t){return{year:t.year,value:s[u],defined:0}}).filter(function(t){return t.year==u&&(t.defined=!0),t.year>=u}));var V=d3.select(".result."+n),O=function(){A.attr("d",T.defined(h("defined"))(C[n].yourData));var t=C[n].yourData[C[n].yourData.length-1];if(t.defined){var e=k.labels.selectAll(".your-result").data([t]);e.enter().append("div").classed("data-label your-result",!0).classed("edge-right",l).merge(e).style("left",function(){return k.x(c)+"px"}).style("top",function(t){return k.y(t.value)+"px"}).html("").append("span").text(function(t){return f(t.value,2)})}};O();var W=function(){if(!C[n].resultShown){r.node().classList.add("drawn");var t=d3.mouse(k.svg.node()),e=g(u,c,k.x.invert(t[0])),a=g(k.y.domain()[0],k.y.domain()[1],k.y.invert(t[1]));C[n].yourData.forEach(function(t){t.year>u&&(Math.abs(t.year-e)<.5&&(t.value=a),t.year-e<.5&&(t.defined=!0))}),O(),C[n].completed||1!=d3.mean(C[n].yourData,h("defined"))||(C[n].completed=!0,V.node().classList.add("finished"),V.select("button").node().removeAttribute("disabled"))}};k.svg.call(d3.drag().on("drag",W)),k.svg.on("click",W);var Y=function(){C[n].completed&&(C[n].resultShown=!0,N.transition().duration(700).attr("width",k.x(c)),S.attr("class",""),setTimeout(function(){B.map(function(t){return t.style("opacity",1)}),V.node().classList.add("shown")},700))};V.select("button").on("click",Y),C[n].resultShown&&Y(),r.on("mousemove",function(){var t=d3.mouse(k.svg.node()),e=Math.min(Math.max(t[1],k.y(D)),k.y(L));k.preview.attr("y2",e)})}})};document.addEventListener("DOMContentLoaded",t);var r,n,i,s;window.addEventListener("resize",(r=function(){t()},n=500,s=void 0,function(){var t=this,e=arguments,a=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||r.apply(t,e)},n),a&&r.apply(t,e)}))}();