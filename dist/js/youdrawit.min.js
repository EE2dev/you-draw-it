"use strict";!function(){var q={},t=function(){d3.selectAll(".you-draw-it").each(function(){var n=d3.select(this),i=this.dataset.key,r=window.ydi_data[i],l=r.data,d=Object.keys(l).map(function(t){return{year:Number(t),value:l[t]}});if(q[i]||(q[i]={}),d.length<1)console.log("No data available for:",i);else{var s=window.innerWidth<760,o=d[0].year,c=d[d.length-1].year,t=r.lastPointShownAt,p=[{year:t,class:"blue",title:""},{year:c,class:"blue",title:"Ihre\nEinschÃ¤tzung"}],u=1<p.length?p[p.length-2].year:p[0].year,e=d3.min(d,function(t){return t.value}),a=d3.max(d,function(t){return t.value}),h=[o].concat(p.map(function(t){return t.year})),v=function(){for(var r=arguments,t=0;t<r.length;t++)"string"!=typeof r[t]&&"number"!=typeof r[t]||(r[t]=function(e){return function(t){return t[e]}}(r[t]));return function(t){for(var e=0,a=r.length;e++<a;)t=r[e-1].call(this,t);return t}},f=function(t,e){var a=r.precision?Number(t).toFixed(r.precision):e?Number(t).toFixed(e):t;return String(a).replace(".",",")+(r.unit?" "+r.unit:"")},y=function(t,e){var a=A.x(t),r=A.y(l[t]),n=f(l[t]),i=A.labels.append("div").classed("data-label",!0).classed(e,!0).style("left",a+"px").style("top",r+"px");return i.append("span").text(n),t==o&&s&&i.classed("edge-left",!0),t==c&&s&&i.classed("edge-right",!0),[A.dots.append("circle").attr("r",4.5).attr("cx",a).attr("cy",r).attr("class",e),i]},g=function(t,e,a){return Math.max(t,Math.min(e,a))};n.html("");var x=20,m=s?20:50,w=20,b=s?20:100,k=n.node().offsetWidth,A={width:k-(b+m),height:400-(x+w)},L=Math.min(e,0),M=Math.max(2*l[u],a+.4*(a-L));A.x=d3.scaleLinear().range([0,A.width]),A.x.domain([o,c]),A.y=d3.scaleLinear().range([A.height,0]),A.y.domain([L,M]),A.svg=n.append("svg").attr("width",k).attr("height",400).append("g").attr("transform","translate("+b+","+x+")").attr("width",A.width).attr("height",A.height),A.defs=d3.select(A.svg.node().parentNode).append("defs"),["black","red","blue"].forEach(function(t){var e=A.defs.append("linearGradient").attr("id","gradient-"+t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("class","start"),e.append("stop").attr("offset","100%").attr("class","end")}),A.defs.append("marker").attr("id","preview-arrowp").attr("orient","auto").attr("viewBox","0 0 10 10").attr("markerWidth",6).attr("markerHeight",6).attr("refX",1).attr("refY",5).append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),A.grid=A.svg.append("g").attr("class","grid"),A.grid.append("g").attr("class","horizontal").call(d3.axisBottom(A.x).tickValues(A.x.ticks(c-o)).tickFormat("").tickSize(A.height)).selectAll("line").attr("class",function(t,e){return-1!==h.indexOf(t)?"highlight":""}),A.grid.append("g").attr("class","vertical").call(d3.axisLeft(A.y).tickValues(A.y.ticks(6)).tickFormat("").tickSize(-A.width));var D=function(t){t.style("left",b+"px").style("top",x+"px").style("width",A.width+"px").style("height",A.height+"px")},S=A.svg.append("rect").attr("class","draggable").attr("x",A.x(u)).attr("width",A.x(c)-A.x(u)).attr("height",A.height).attr("opacity",0);setTimeout(function(){var t=A.svg.node().getBoundingClientRect();A.top=t.top+window.scrollY,A.bottom=t.bottom+window.scrollY},1e3),A.labels=n.append("div").attr("class","labels").call(D),A.axis=A.svg.append("g"),A.charts=A.svg.append("g");var T,z=A.svg.append("path").attr("class","your-line");A.dots=A.svg.append("g").attr("class","dots"),A.xAxis=d3.axisBottom().scale(A.x),A.xAxis.tickFormat(function(t){return t}).ticks(c-o),A.yAxis=d3.axisLeft().scale(A.y).tickValues(A.y.ticks(6)),A.yAxis.tickFormat(function(t){return f(t)}),(T=A).axis.append("g").attr("class","x axis").attr("transform","translate(0,"+T.height+")").call(T.xAxis),T.axis.append("g").attr("class","y axis").call(T.yAxis),A.titles=n.append("div").attr("class","titles").call(D);var E=A.x(u),F=A.y(l[u]),N=F<=350?E+45:E+70,B=F<=350?F+30:F-30,P=F<=350?A.y(l[t])+30:A.y(l[t])-65,W=F<=350?A.x(t)+30:A.x(t)+65;A.preview=A.svg.append("path").attr("class","controls preview-pointer").attr("marker-end","url(#preview-arrowp)").attr("d","M"+N+","+B+" Q"+N+","+F+" "+(E+15)+","+F);var X=d3.arc().startAngle(0).endAngle(Math.PI),O=Array(10).fill({});A.wave=A.svg.append("g").attr("class","wave controls"),A.wave.append("clipPath").attr("id","wave-clip-"+i).append("rect").attr("width",A.width).attr("height",A.height),A.wave=A.wave.append("g").attr("clip-path","url(#wave-clip-"+i+")").append("g").attr("transform","translate("+E+", "+F+")").selectAll("path").data(O).enter().append("path").attr("class","wave").attr("d",X),Z(),A.controls=n.append("div").attr("class","controls").call(D).style("padding-left",A.x(o)+"px"),A.controls.append("span").style("left",W+"px").style("top",P+"px").text("Zeichnen Sie von hier\ndie Linie zu Ende");var R=p.map(function(t,e){var a=0<e?p[e-1].year:o,r=t.year;return A.titles.append("span").style("left",A.x(a)+"px").style("width",A.x(r)-A.x(a)+"px").text(t.title),function(a,r,t){var e=function(t,e){return t.year>=a&&t.year<=r},n=d3.area().curve(d3.curveMonotoneX).x(v("year",A.x)).y0(v("value",A.y)).y1(A.height).defined(e),i=d3.area().curve(d3.curveMonotoneX).x(v("year",A.x)).y(v("value",A.y)).defined(e);a==o&&y(o,t);var l=t+(r==u?" median":""),s=A.charts.append("g");return s.append("path").attr("d",n(d)).attr("class","area "+l).attr("fill","url(#gradient-"+t+")"),s.append("path").attr("d",i(d)).attr("class","line "+l),[s].concat(y(r,l))}(a,r,t.class)}),V=R[R.length-1][0],Y=A.charts.append("clipPath").attr("id","result-clip-"+i).append("rect").attr("width",A.x(u)).attr("height",A.height),C=R[R.length-1].slice(1,3);V.attr("clip-path","url(#result-clip-"+i+")").append("rect").attr("width",A.width).attr("height",A.height).attr("fill","none"),C.map(function(t){return t.style("opacity",0)});var I=d3.line().x(v("year",A.x)).y(v("value",A.y)).curve(d3.curveMonotoneX);q[i].yourData||(q[i].yourData=d.map(function(t){return{year:t.year,value:l[u],defined:0}}).filter(function(t){return t.year==u&&(t.defined=!0),t.year>=u}));var j=d3.select(".result."+i),G=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:u;z.attr("d",I.defined(v("defined"))(q[i].yourData));var t=q[i].yourData.filter(function(t){return t.year===e})[0];if(t.defined){var a=A.labels.selectAll(".your-result").data([t]);a.enter().append("div").classed("data-label your-result",!0).classed("edge-right",s).merge(a).style("left",function(){return A.x(e)+"px"}).style("top",function(t){return A.y(t.value)+"px"}).html("").append("span").text(function(t){return f(t.value,2)})}};G();var H=function(){if(!q[i].resultShown){n.node().classList.add("drawn");var t=d3.mouse(A.svg.node()),e=g(u,c,A.x.invert(t[0])),a=g(A.y.domain()[0],A.y.domain()[1],A.y.invert(t[1])),r=void 0;q[i].yourData.forEach(function(t){t.year>u&&(Math.abs(t.year-e)<.5&&(t.value=a,r=t.year),t.year-e<.5&&(t.defined=!0))}),G(r),q[i].completed||1!=d3.mean(q[i].yourData,v("defined"))||(q[i].completed=!0,j.node().classList.add("finished"),j.select("button").node().removeAttribute("disabled"))}};A.svg.call(d3.drag().on("drag",H)),A.svg.on("click",H);var Q=function(){q[i].completed&&(A.labels.selectAll(".your-result").node().classList.add("hideLabels"),function(){var t=0,e=d.filter(function(t){return t.year>u}),a=(q[i].yourData,0),r=0;e.forEach(function(t,e){a+=Math.max(M-t.value,t.value-L),r+=Math.abs(t.value-q[i].yourData[e+1].value)});var n=d3.scaleLinear().domain([0,a]).range([100,0]);t=n(r).toFixed(1),console.log(q[i].yourData),console.log(d),console.log("The pred is: "+r),console.log("The maxDiff is: "+a),console.log("The score is: "+t)}(),q[i].resultShown=!0,Y.transition().duration(700).attr("width",A.x(c)),S.attr("class",""),setTimeout(function(){C.map(function(t){return t.style("opacity",1)}),j.node().classList.add("shown")},700))};j.select("button").on("click",Q),q[i].resultShown&&Q(),n.on("mousemove",function(){var t=d3.mouse(A.svg.node()),e=Math.min(Math.max(t[1],A.y(M)),A.y(L));A.preview.attr("y2",e)})}function Z(){console.log("moveWave"),A.wave.style("opacity",.6).transition().ease(d3.easeLinear).delay(function(t,e){return 1e3+300*e}).duration(4e3).attrTween("d",function(e){if(n.classed("drawn"))return A.wave.interrupt(),void console.log("waves interrupted");var a=d3.interpolate(0,100);return function(t){return e.innerRadius=a(t),e.outerRadius=a(t)+3,X(e)}}).style("opacity",0).on("end",_)}function _(t,e){if(e===O.length-1){var a=Array(O.length).fill({});A.wave=A.wave.data(a),A.wave.attr("d",X),Z()}}})};document.addEventListener("DOMContentLoaded",t);var r,n,i,l;window.addEventListener("resize",(r=function(){t()},n=500,l=void 0,function(){var t=this,e=arguments,a=i&&!l;clearTimeout(l),l=setTimeout(function(){l=null,i||r.apply(t,e)},n),a&&r.apply(t,e)}))}();