!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.youdrawit={},t.d3)}(this,function(t,tt){"use strict";function c(s,c,n,d,i,u,p,e,o){var l=p[0].year,f=p[p.length-1].year,h=e.indexOf(i.lastPointShownAt.toString()),v=[{year:h,class:"blue",title:""},{year:f,class:"blue",title:u.predictionTitle}],t=tt.min(p,function(t){return t.value}),a=tt.max(p,function(t){return t.value}),r=[l].concat(v.map(function(t){return t.year})),y=function(){for(var r=arguments,t=0;t<r.length;t++)"string"!=typeof r[t]&&"number"!=typeof r[t]||(r[t]=function(e){return function(t){return t[e]}}(r[t]));return function(t){for(var e=0,a=r.length;e++<a;)t=r[e-1].call(this,t);return t}},g=function(t,e){var a=i.precision?Number(t).toFixed(i.precision):0!==e?Number(t).toFixed(e):0===e?Number(t).toFixed():t;return String(a).replace(".",",")+(i.unit?" "+i.unit:"")},x=function(t,e){var a=L.x(t),r=L.y(o[t]),n=g(o[t]),i=L.labels.append("div").classed("data-label",!0).classed(e,!0).style("left",a+"px").style("top",r+"px");return i.append("span").text(n),t==l&&s&&i.classed("edge-left",!0),t==f&&s&&i.classed("edge-right",!0),[L.dots.append("circle").attr("r",4.5).attr("cx",a).attr("cy",r).attr("class",e),i]},m=function(t,e,a){return Math.max(t,Math.min(e,a))};n.html("");var w=20,b=s?20:50,k=30,A=s?20:100,M=n.node().offsetWidth,L={width:M-(A+b),height:400-(w+k)};function D(t,e){return Math.random()*(e-t)+t}var T=i.yAxisMin?i.yAxisMin:0<=t?0:t*D(1,1.5),S=i.yAxisMax?i.yAxisMax:a+(a-T)*D(.4,1);L.x=tt.scaleLinear().range([0,L.width]),L.x.domain([l,f]),L.y=tt.scaleLinear().range([L.height,0]),L.y.domain([T,S]),L.svg=n.append("svg").attr("width",M).attr("height",400).append("g").attr("transform","translate("+A+","+w+")").attr("width",L.width).attr("height",L.height),L.defs=tt.select(L.svg.node().parentNode).append("defs"),["black","red","blue"].forEach(function(t){var e=L.defs.append("linearGradient").attr("id","gradient-"+t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("class","start"),e.append("stop").attr("offset","100%").attr("class","end")}),L.defs.append("marker").attr("id","preview-arrowp").attr("orient","auto").attr("viewBox","0 0 10 10").attr("markerWidth",6).attr("markerHeight",6).attr("refX",1).attr("refY",5).append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),L.grid=L.svg.append("g").attr("class","grid"),L.grid.append("g").attr("class","horizontal").call(tt.axisBottom(L.x).tickValues(L.x.ticks(f-l)).tickFormat("").tickSize(L.height)).selectAll("line").attr("class",function(t){return-1!==r.indexOf(t)?"highlight":""}),L.grid.append("g").attr("class","vertical").call(tt.axisLeft(L.y).tickValues(L.y.ticks(6)).tickFormat("").tickSize(-L.width));var F=function(t){t.style("left",A+"px").style("top",w+"px").style("width",L.width+"px").style("height",L.height+"px")},O=L.svg.append("rect").attr("class","draggable").attr("x",L.x(h)).attr("width",L.x(f)-L.x(h)).attr("height",L.height).attr("opacity",0);setTimeout(function(){var t=L.svg.node().getBoundingClientRect();L.top=t.top+window.scrollY,L.bottom=t.bottom+window.scrollY},1e3),L.labels=n.append("div").attr("class","labels").call(F),L.axis=L.svg.append("g"),L.charts=L.svg.append("g");var E,P=L.svg.append("path").attr("class","your-line");L.dots=L.svg.append("g").attr("class","dots"),L.xAxis=tt.axisBottom().scale(L.x),L.xAxis.tickFormat(function(t){return e[t]}).ticks(f-l),L.yAxis=tt.axisLeft().scale(L.y).tickValues(L.y.ticks(6)),L.yAxis.tickFormat(function(t){return g(t)}),(E=L).axis.append("g").attr("class","x axis").attr("transform","translate(0,"+E.height+")").call(E.xAxis),E.axis.append("g").attr("class","y axis").call(E.yAxis),L.titles=n.append("div").attr("class","titles").call(F).style("top","0px");var j=L.x(h),z=L.y(o[h]),B=z<=300?j+45:j+70,N=z<=300?z+30:z-30,R=z<=300?L.y(o[h])+30:L.y(o[h])-65,W=z<=300?L.x(h)+30:L.x(h)+65;L.preview=L.svg.append("path").attr("class","controls preview-pointer").attr("marker-end","url(#preview-arrowp)").attr("d","M"+B+","+N+" Q"+B+","+z+" "+(j+15)+","+z);var X=tt.arc().startAngle(0).endAngle(Math.PI),_=Y(4);function V(){console.log("moveWave"),L.wave.style("opacity",.6).transition().ease(tt.easeLinear).delay(function(t,e){return 1e3+300*e}).duration(4e3).attrTween("d",function(e){if(n.classed("drawn"))return L.wave.interrupt(),void console.log("waves interrupted");var a=tt.interpolate(0,100);return function(t){return e.innerRadius=a(t),e.outerRadius=a(t)+3,X(e)}}).style("opacity",0).on("end",C)}function Y(t){for(var e=[],a=0;a<t;a++)e.push({});return e}function C(t,e){if(e===_.length-1){var a=Y(4);L.wave=L.wave.data(a),L.wave.attr("d",X),V()}}L.wave=L.svg.append("g").attr("class","wave controls"),L.wave.append("clipPath").attr("id","wave-clip-"+d).append("rect").attr("width",L.width).attr("height",L.height),L.wave=L.wave.append("g").attr("clip-path","url(#wave-clip-"+d+")").append("g").attr("transform","translate("+j+", "+z+")").selectAll("path").data(_).enter().append("path").attr("class","wave").attr("d",X),V(),L.controls=n.append("div").attr("class","controls").call(F).style("padding-left",L.x(l)+"px"),L.controls.append("span").style("left",W+"px").style("top",R+"px").text("Zeichnen Sie von hier\ndie Linie zu Ende");var I=v.map(function(t,e){var a=0<e?v[e-1].year:l,r=t.year;return L.titles.append("span").style("left",L.x(a)+"px").style("width",L.x(r)-L.x(a)+"px").text(t.title),function(e,a,t){var r=function(t){return t.year>=e&&t.year<=a},n=tt.area().curve(tt.curveMonotoneX).x(y("year",L.x)).y0(y("value",L.y)).y1(L.height).defined(r),i=tt.area().curve(tt.curveMonotoneX).x(y("year",L.x)).y(y("value",L.y)).defined(r);e==l&&x(l,t);var s=t+(a==h?" median":""),o=L.charts.append("g");return o.append("path").attr("d",n(p)).attr("class","area "+s).attr("fill","url(#gradient-"+t+")"),o.append("path").attr("d",i(p)).attr("class","line "+s),[o].concat(x(a,s))}(a,r,t.class)}),q=I[I.length-1][0],G=L.charts.append("clipPath").attr("id","result-clip-"+d).append("rect").attr("width",L.x(h)).attr("height",L.height),H=I[I.length-1].slice(1,3);q.attr("clip-path","url(#result-clip-"+d+")").append("rect").attr("width",L.width).attr("height",L.height).attr("fill","none"),H.map(function(t){return t.style("opacity",0)});var Q=tt.line().x(y("year",L.x)).y(y("value",L.y)).curve(tt.curveMonotoneX);c[d].yourData||(c[d].yourData=p.map(function(t){return{year:t.year,value:o[h],defined:0}}).filter(function(t){return t.year==h&&(t.defined=!0),t.year>=h}));var Z=tt.select(".result."+d),J=function(e){P.attr("d",Q.defined(y("defined"))(c[d].yourData));var t=c[d].yourData.filter(function(t){return t.year===e})[0],a=c[d].yourData.filter(function(t){return t.defined&&t.year!==h});if(t.defined){var r=L.dots.selectAll("circle.result").data(a);r.enter().append("circle").merge(r).attr("r",4.5).attr("cx",function(t){return L.x(t.year)}).attr("cy",function(t){return L.y(t.value)}).attr("class","result");var n=L.labels.selectAll(".your-result").data([t]);n.enter().append("div").classed("data-label your-result",!0).classed("edge-right",s).merge(n).style("left",function(){return L.x(e)+"px"}).style("top",function(t){return L.y(t.value)+"px"}).html("").append("span").text(function(t){return i.precision?g(t.value):g(t.value,0)})}};J(h);var K=function(){if(!c[d].resultShown){n.node().classList.add("drawn");var t=tt.mouse(L.svg.node()),e=m(h,f,L.x.invert(t[0])),a=m(L.y.domain()[0],L.y.domain()[1],L.y.invert(t[1])),r=h;c[d].yourData.forEach(function(t){t.year>h&&(Math.abs(t.year-e)<.5&&(t.value=a,r=t.year),t.year-e<.5&&(t.defined=!0,r=t.year))}),J(r),c[d].completed||1!=tt.mean(c[d].yourData,y("defined"))||(c[d].completed=!0,Z.node().classList.add("finished"),Z.select("button").node().removeAttribute("disabled"))}};L.svg.call(tt.drag().on("drag",K)),L.svg.on("click",K);var U=function(){c[d].completed&&(L.labels.selectAll(".your-result").node().classList.add("hideLabels"),c[d].score||function(){var t=0,e=p.filter(function(t){return t.year>h}),a=0,r=0;e.forEach(function(t,e){a+=Math.max(S-t.value,t.value-T),r+=Math.abs(t.value-c[d].yourData[e+1].value)});var n=tt.scaleLinear().domain([0,a]).range([100,0]);t=n(r).toFixed(1),c[d].predictionDiff=r,c[d].score=+t;var i=!0;if(Object.keys(c).forEach(function(t){i=i&&void 0!==c[t].score}),i){var s=0;Object.keys(c).forEach(function(t){s+=c[t].score});var o=tt.scaleLinear().domain([0,100*Object.keys(c).length]).range([0,100]),l=o(s).toFixed();console.log("The final score is: "+l),function(t){var e={};e.div=Z.select("div.text").append("div").attr("class","finalScore"),e.div.append("div").attr("class","before-finalScore").append("strong").text(u.yourResult),e.svg=e.div.append("svg").attr("width",500).attr("height",75),e.g=e.svg.append("g").attr("transform","translate(5, 10)");var a=tt.scaleLinear().domain([0,100]).range([0,400]),r=tt.axisBottom(a).ticks(4);e.g.append("g").attr("transform","translate(0, 45)").call(r),e.rect=e.g.append("rect").attr("class","final-score-result").attr("x",0).attr("y",0).attr("height",40).attr("width",0),e.txt=e.g.append("text").attr("class","scoreText").attr("x",a(t)+5).attr("dy",27).text("("+t+"/100)"),e.rect.transition().duration(3e3).attr("width",a(t)).on("end",$)}(+l)}console.log(c[d].yourData),console.log(p),console.log("The pred is: "+r),console.log("The maxDiff is: "+a),console.log("The score is: "+t)}(),c[d].resultShown=!0,G.transition().duration(700).attr("width",L.x(f)),O.attr("class",""),setTimeout(function(){H.map(function(t){return t.style("opacity",1)}),Z.node().classList.add("shown")},700))};function $(){tt.select(".result."+d).select("text.scoreText").style("opacity",1)}Z.select("button").on("click",U),c[d].resultShown&&U(),n.on("mousemove",function(){var t=tt.mouse(L.svg.node()),e=Math.min(Math.max(t[1],L.y(S)),L.y(T));L.preview.attr("y2",e)})}t.chart=function(){var r,n,i,s,o=window.innerWidth<760,l={},t=function(){tt.selectAll(".you-draw-it").each(function(){var t=tt.select(this),e=this.dataset.key,a=window.ydi_data[e],r=window.ydi_globals,n=a.data.map(function(t,e){return{year:e,timePointIndex:e,timePoint:Object.keys(t)[0],value:t[Object.keys(t)[0]]}}),i=n.map(function(t){return t.timePoint}),s=n.map(function(t){return t.value});l[e]||(l[e]={}),n.length<1?console.log("No data available for:",e):c(o,l,t,e,a,r,n,i,s)})};document.addEventListener("DOMContentLoaded",t),window.addEventListener("resize",(r=function(){t()},n=500,s=void 0,function(){var t=this,e=arguments,a=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||r.apply(t,e)},n),a&&r.apply(t,e)}))},Object.defineProperty(t,"__esModule",{value:!0})});