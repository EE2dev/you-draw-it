!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.youdrawit={},t.d3)}(this,function(t,U){"use strict";var $=function(){for(var n=arguments,t=0;t<n.length;t++)"string"!=typeof n[t]&&"number"!=typeof n[t]||(n[t]=function(e){return function(t){return t[e]}}(n[t]));return function(t){for(var e=0,a=n.length;e++<a;)t=n[e-1].call(this,t);return t}},tt=function(t,e,a,n){var r=a?Number(t).toFixed(a):0!==n?Number(t).toFixed(n):0===n?Number(t).toFixed():t;return String(r).replace(".",",")+(e?" "+e:"")},et=function(t,e,a){return Math.max(t,Math.min(e,a))};function at(t,e){return Math.random()*(e-t)+t}var nt="yourData",rt="resultShown",it="completed",st="score",m="predictionDiff",lt="prediction",ot="truth";function dt(t,e,a,n,r,i,s){var l,o,d,c,p,u,g=a.get(t,nt),f=(o=g,d=n,c=r,u=p=0,e.forEach(function(t,e){p+=Math.max(d-t.value,t.value-c),u+=Math.abs(t.value-o[e+1].value)}),{maxDiff:p,predDiff:u}),h=f.maxDiff,v=f.predDiff;l=U.scaleLinear().domain([0,h]).range([100,0])(v).toFixed(1),a.set(t,m,v),a.set(t,st,+l);var y=!0;if(a.getAllQuestions().forEach(function(t){y=y&&void 0!==a.get(t,st)}),y){var x=0;a.getAllQuestions().forEach(function(t){x+=a.get(t,st)});var w=U.scaleLinear().domain([0,100*a.getAllQuestions().length]).range([0,100])(x).toFixed();console.log("The final score is: "+w),function(t,e,a,n){var r={};r.div=e.select("div.text").append("div").attr("class","finalScore"),r.div.append("div").attr("class","before-finalScore").append("strong").text(n),r.svg=r.div.append("svg").attr("width",500).attr("height",75),r.g=r.svg.append("g").attr("transform","translate(5, 10)");var i=U.scaleLinear().domain([0,100]).range([0,400]),s=U.axisBottom(i).ticks(4);r.g.append("g").attr("transform","translate(0, 45)").call(s),r.rect=r.g.append("rect").attr("class","final-score-result").attr("x",0).attr("y",0).attr("height",40).attr("width",0),r.txt=r.g.append("text").attr("class","scoreText").attr("x",i(t)+5).attr("dy",27).text("("+t+"/100)"),r.rect.transition().duration(3e3).attr("width",i(t)).on("end",function(){U.select(".result."+a).select("text.scoreText").style("opacity",1)})}(+w,i,t,s)}console.log(a.get(t,nt)),console.log("The pred is: "+v),console.log("The maxDiff is: "+h),console.log("The score is: "+l),console.log(a.getState())}function p(s,i,r,l,o,e,d,a,c){var p=d[0].timePointIndex,u=d[d.length-1].timePointIndex,t=U.min(d,function(t){return t.value}),n=U.max(d,function(t){return t.value}),g=a.indexOf(o.lastPointShownAt.toString()),f=[{year:g,class:"blue",title:""},{year:u,class:"blue",title:e.predictionTitle}],h=[p].concat(f.map(function(t){return t.year})),v=function(t,e){var a=A.x(t),n=A.y(c[t]),r=tt(c[t],o.unit,o.precision),i=A.labels.append("div").classed("data-label",!0).classed(e,!0).style("left",a+"px").style("top",n+"px");return i.append("span").text(r),t==p&&s&&i.classed("edge-left",!0),t==u&&s&&i.classed("edge-right",!0),[A.dots.append("circle").attr("r",4.5).attr("cx",a).attr("cy",n).attr("class",e),i]};r.html("");var y=20,x=s?20:50,w=30,m=s?20:100,b=r.node().offsetWidth,A={width:b-(m+x),height:400-(y+w)},k=o.yAxisMin?o.yAxisMin:0<=t?0:t*at(1,1.5),L=o.yAxisMax?o.yAxisMax:n+(n-k)*at(.4,1);A.x=U.scaleLinear().range([0,A.width]),A.x.domain([p,u]),A.y=U.scaleLinear().range([A.height,0]),A.y.domain([k,L]),A.svg=r.append("svg").attr("width",b).attr("height",400).append("g").attr("transform","translate("+m+","+y+")").attr("width",A.width).attr("height",A.height),A.defs=U.select(A.svg.node().parentNode).append("defs"),["black","red","blue"].forEach(function(t){var e=A.defs.append("linearGradient").attr("id","gradient-"+t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("class","start"),e.append("stop").attr("offset","100%").attr("class","end")}),A.defs.append("marker").attr("id","preview-arrowp").attr("orient","auto").attr("viewBox","0 0 10 10").attr("markerWidth",6).attr("markerHeight",6).attr("refX",1).attr("refY",5).append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),A.grid=A.svg.append("g").attr("class","grid"),A.grid.append("g").attr("class","horizontal").call(U.axisBottom(A.x).tickValues(A.x.ticks(u-p)).tickFormat("").tickSize(A.height)).selectAll("line").attr("class",function(t){return-1!==h.indexOf(t)?"highlight":""}),A.grid.append("g").attr("class","vertical").call(U.axisLeft(A.y).tickValues(A.y.ticks(6)).tickFormat("").tickSize(-A.width));var M=function(t){t.style("left",m+"px").style("top",y+"px").style("width",A.width+"px").style("height",A.height+"px")},P=A.svg.append("rect").attr("class","draggable").attr("x",A.x(g)).attr("width",A.x(u)-A.x(g)).attr("height",A.height).attr("opacity",0);setTimeout(function(){var t=A.svg.node().getBoundingClientRect();A.top=t.top+window.scrollY,A.bottom=t.bottom+window.scrollY},1e3),A.labels=r.append("div").attr("class","labels").call(M),A.axis=A.svg.append("g"),A.charts=A.svg.append("g");var S,T=A.svg.append("path").attr("class","your-line");A.dots=A.svg.append("g").attr("class","dots"),A.xAxis=U.axisBottom().scale(A.x),A.xAxis.tickFormat(function(t){return a[t]}).ticks(u-p),A.yAxis=U.axisLeft().scale(A.y).tickValues(A.y.ticks(6)),A.yAxis.tickFormat(function(t){return tt(t)},o.unit,o.precision),(S=A).axis.append("g").attr("class","x axis").attr("transform","translate(0,"+S.height+")").call(S.xAxis),S.axis.append("g").attr("class","y axis").call(S.yAxis),A.titles=r.append("div").attr("class","titles").call(M).style("top","0px");var F=A.x(g),D=A.y(c[g]),B=D<=300?F+45:F+70,E=D<=300?D+30:D-30,Q=D<=300?A.y(c[g])+30:A.y(c[g])-65,R=D<=300?A.x(g)+30:A.x(g)+65;A.preview=A.svg.append("path").attr("class","controls preview-pointer").attr("marker-end","url(#preview-arrowp)").attr("d","M"+B+","+E+" Q"+B+","+D+" "+(F+15)+","+D);var O=U.arc().startAngle(0).endAngle(Math.PI),z=I(4);function C(){console.log("moveWave"),A.wave.style("opacity",.6).transition().ease(U.easeLinear).delay(function(t,e){return 1e3+300*e}).duration(4e3).attrTween("d",function(e){if(r.classed("drawn"))return A.wave.interrupt(),void console.log("waves interrupted");var a=U.interpolate(0,100);return function(t){return e.innerRadius=a(t),e.outerRadius=a(t)+3,O(e)}}).style("opacity",0).on("end",W)}function I(t){for(var e=[],a=0;a<t;a++)e.push({});return e}function W(t,e){if(e===z.length-1){var a=I(4);A.wave=A.wave.data(a),A.wave.attr("d",O),C()}}A.wave=A.svg.append("g").attr("class","wave controls"),A.wave.append("clipPath").attr("id","wave-clip-"+l).append("rect").attr("width",A.width).attr("height",A.height),A.wave=A.wave.append("g").attr("clip-path","url(#wave-clip-"+l+")").append("g").attr("transform","translate("+F+", "+D+")").selectAll("path").data(z).enter().append("path").attr("class","wave").attr("d",O),C(),A.controls=r.append("div").attr("class","controls").call(M).style("padding-left",A.x(p)+"px"),A.controls.append("span").style("left",R+"px").style("top",Q+"px").text("Zeichnen Sie von hier\ndie Linie zu Ende");var j=f.map(function(t,e){var a=0<e?f[e-1].year:p,n=t.year;return A.titles.append("span").style("left",A.x(a)+"px").style("width",A.x(n)-A.x(a)+"px").text(t.title),function(e,a,t){var n=function(t){return t.year>=e&&t.year<=a},r=U.area().curve(U.curveMonotoneX).x($("year",A.x)).y0($("value",A.y)).y1(A.height).defined(n),i=U.area().curve(U.curveMonotoneX).x($("year",A.x)).y($("value",A.y)).defined(n);e==p&&v(p,t);var s=t+(a==g?" median":""),l=A.charts.append("g");return l.append("path").attr("d",r(d)).attr("class","area "+s).attr("fill","url(#gradient-"+t+")"),l.append("path").attr("d",i(d)).attr("class","line "+s),[l].concat(v(a,s))}(a,n,t.class)}),N=j[j.length-1][0],V=A.charts.append("clipPath").attr("id","result-clip-"+l).append("rect").attr("width",A.x(g)).attr("height",A.height),Y=j[j.length-1].slice(1,3);N.attr("clip-path","url(#result-clip-"+l+")").append("rect").attr("width",A.width).attr("height",A.height).attr("fill","none"),Y.map(function(t){return t.style("opacity",0)});var X=U.line().x($("year",A.x)).y($("value",A.y)).curve(U.curveMonotoneX);if(!i.get(l,nt)){var _=d.map(function(t){return{year:t.year,value:c[g],defined:0}}).filter(function(t){return t.year==g&&(t.defined=!0),t.year>=g});i.set(l,"yourData",_)}var H=U.select(".result."+l),Z=function(e){T.attr("d",X.defined($("defined"))(i.get(l,nt)));var t=i.get(l,nt).filter(function(t){return t.year===e})[0],a=i.get(l,nt).filter(function(t){return t.defined&&t.year!==g});if(t.defined){var n=A.dots.selectAll("circle.result").data(a);n.enter().append("circle").merge(n).attr("r",4.5).attr("cx",function(t){return A.x(t.year)}).attr("cy",function(t){return A.y(t.value)}).attr("class","result");var r=A.labels.selectAll(".your-result").data([t]);r.enter().append("div").classed("data-label your-result",!0).classed("edge-right",s).merge(r).style("left",function(){return A.x(e)+"px"}).style("top",function(t){return A.y(t.value)+"px"}).html("").append("span").text(function(t){return o.precision?tt(t.value,o.unit,o.precision):tt(t.value,o.unit,o.precision,0)})}};Z(g);var q=function(){if(!i.get(l,rt)){r.node().classList.add("drawn");var t=U.mouse(A.svg.node()),e=et(g,u,A.x.invert(t[0])),a=et(A.y.domain()[0],A.y.domain()[1],A.y.invert(t[1])),n=g;i.get(l,nt).forEach(function(t){t.year>g&&(Math.abs(t.year-e)<.5&&(t.value=a,n=t.year),t.year-e<.5&&(t.defined=!0,n=t.year))}),Z(n),i.get(l,it)||1!=U.mean(i.get(l,nt),$("defined"))||(i.set(l,it,!0),H.node().classList.add("finished"),H.select("button").node().removeAttribute("disabled"))}};A.svg.call(U.drag().on("drag",q)),A.svg.on("click",q);var G=function(){if(i.get(l,it)){if(A.labels.selectAll(".your-result").node().classList.add("hideLabels"),!i.get(l,st)){var t=d.filter(function(t){return t.year>g});dt(l,t,i,L,k,H,e.yourResult)}i.set(l,rt,!0),V.transition().duration(700).attr("width",A.x(u)),P.attr("class",""),setTimeout(function(){Y.map(function(t){return t.style("opacity",1)}),H.node().classList.add("shown")},700)}};H.select("button").on("click",G),i.get(l,rt)&&G()}function u(r,i,n,s,l,a,o,t,e){var d=o[0].timePointIndex,c=o[o.length-1].timePointIndex,p=U.min(o,function(t){return t.value}),u=U.max(o,function(t){return t.value}),g=t.indexOf(l.lastPointShownAt.toString());n.html("");var f=20,h=r?20:50,v=30,y=r?20:100,x=n.node().offsetWidth,w={width:x-(y+h),height:400-(f+v)},m=l.yAxisMin?l.yAxisMin:0<=p?0:p*at(1,1.5),b=l.yAxisMax?l.yAxisMax:u+(u-m)*at(.4,1);w.x=U.scaleBand().rangeRound([0,w.width]).padding(.1),w.x.domain([lt,ot]),w.y=U.scaleLinear().range([w.height,0]),w.y.domain([m,b]),w.svg=n.append("svg").attr("width",x).attr("height",400).append("g").attr("transform","translate("+y+","+f+")").attr("width",w.width).attr("height",w.height),w.grid=w.svg.append("g").attr("class","grid"),w.grid.append("g").attr("class","vertical").call(U.axisLeft(w.y).tickValues(w.y.ticks(6)).tickFormat("").tickSize(-w.width));var A=function(t){t.style("left",y+"px").style("top",f+"px").style("width",w.width+"px").style("height",w.height+"px")},k=w.svg.append("rect").attr("class","draggable").attr("x",w.x(lt)).attr("width",w.x.bandwidth()).attr("height",w.height).attr("opacity",0);setTimeout(function(){var t=w.svg.node().getBoundingClientRect();w.top=t.top+window.scrollY,w.bottom=t.bottom+window.scrollY},1e3),w.labels=n.append("div").attr("class","labels").call(A),w.axis=w.svg.append("g"),w.charts=w.svg.append("g").attr("class","charts"),w.xPredictionCenter=w.x(lt)+w.x.bandwidth()/2;var L,M=w.svg.append("rect").attr("class","your-rect");w.dots=w.svg.append("g").attr("class","dots"),w.xAxis=U.axisBottom().scale(w.x),w.yAxis=U.axisLeft().scale(w.y).tickValues(w.y.ticks(6)),w.yAxis.tickFormat(function(t){return tt(t)},l.unit,l.precision),(L=w).axis.append("g").attr("class","x axis").attr("transform","translate(0,"+L.height+")").call(L.xAxis),L.axis.append("g").attr("class","y axis").call(L.yAxis),w.titles=n.append("div").attr("class","titles").call(A).style("top","0px");var P=w.xPredictionCenter,S=w.height-30,T=P+45,F=S-50,D=T+5,B=F-10;w.preview=w.svg.append("path").attr("class","controls preview-pointer").attr("marker-end","url(#preview-arrowp)").attr("d","M"+T+","+F+" Q"+P+","+F+" "+P+","+(S-10));var E=U.arc().startAngle(0).endAngle(2*Math.PI),Q=O(4);function R(){console.log("moveWave for bars"),w.wave.style("opacity",.6).transition().ease(U.easeLinear).delay(function(t,e){return 1e3+300*e}).duration(4e3).attrTween("d",function(e){if(n.classed("drawn"))return w.wave.interrupt(),void console.log("waves interrupted");var a=U.interpolate(0,100);return function(t){return e.innerRadius=a(t),e.outerRadius=a(t)+3,E(e)}}).style("opacity",0).on("end",z)}function O(t){for(var e=[],a=0;a<t;a++)e.push({});return e}function z(t,e){if(e===Q.length-1){var a=O(4);w.wave=w.wave.data(a),w.wave.attr("d",E),R()}}w.wave=w.svg.append("g").attr("class","wave controls"),w.wave.append("clipPath").attr("id","wave-clip-"+s).append("rect").attr("width",w.width).attr("height",w.height),w.wave=w.wave.append("g").attr("clip-path","url(#wave-clip-"+s+")").append("g").attr("transform","translate("+P+", "+S+")").selectAll("path").data(Q).enter().append("path").attr("class","wave").attr("d",E),R(),w.controls=n.append("div").attr("class","controls").call(A).style("padding-left",w.xPredictionCenter),w.controls.append("span").style("left",D+"px").style("top",B+"px").text("Ziehen Sie den Balken\nin die entsprechende Höhe");var C,I,W,j,N,V,Y,X,_,H=(C="blue",_=w.charts.append("g").attr("class","truth"),I=ot,W=C,j=w.x(ot)+w.x.bandwidth()/2,N=o[0].value,V=w.y(N),Y=tt(N,l.unit,l.precision),(X=w.labels.append("div").classed("data-label",!0).classed(W,!0).style("opacity",0).style("left",j+"px").style("top",V+"px")).append("span").classed("no-dot",!0).text(Y),I==d&&r&&X.classed("edge-left",!0),I==c&&r&&X.classed("edge-right",!0),_.append("rect").attr("class","bar").attr("x",w.x(ot)).attr("y",w.height).attr("height",0).attr("width",w.x.bandwidth()));if(M.attr("x",w.x(lt)).attr("y",w.height-30).attr("width",w.x.bandwidth()).attr("height",30),!i.get(s,nt)){var Z=o.map(function(t){return{year:t.year,value:e[g],defined:0}}).filter(function(t){return t.year==g&&(t.defined=!0),t.year>=g});i.set(s,"yourData",Z)}var q=U.select(".result."+s),G=function(e){var t=w.y(i.get(s,nt)[0].value);M.attr("y",t).attr("height",w.height-t),console.log(i.get(s,nt)[0].value);var a=i.get(s,nt).filter(function(t){return t.year===e})[0];if(a.defined){var n=w.labels.selectAll(".your-result").data([a]);n.enter().append("div").classed("data-label your-result",!0).classed("edge-right",r).merge(n).style("left",w.xPredictionCenter+"px").style("top",function(t){return w.y(t.value)+"px"}).html("").append("span").classed("no-dot",!0).text(function(t){return l.precision?tt(t.value,l.unit,l.precision):tt(t.value,l.unit,l.precision,0)})}};n.classed("drawn")&&G(g);var J=function(){if(!i.get(s,rt)){n.node().classList.add("drawn");var t=U.mouse(w.svg.node()),e=et(w.y.domain()[0],w.y.domain()[1],w.y.invert(t[1])),a=g;i.get(s,nt).forEach(function(t){t.value=e,t.defined=!0,a=t.year}),G(a),i.get(s,it)||1!=U.mean(i.get(s,nt),$("defined"))||(i.set(s,it,!0),q.node().classList.add("finished"),q.select("button").node().removeAttribute("disabled"))}};w.svg.call(U.drag().on("drag",J)),w.svg.on("click",J);var K=function(){if(i.get(s,it)){if(w.labels.selectAll(".your-result").node().classList.add("hideLabels"),!i.get(s,st)){var t=o.filter(function(t){return t.year===g});dt(s,t,i,b,m,q,a.yourResult)}i.set(s,rt,!0);var e=w.y(o[0].value);H.transition().duration(700).attr("y",e).attr("height",w.height-e),k.attr("class",""),setTimeout(function(){w.labels.select("div.data-label").style("opacity",1),q.node().classList.add("shown")},700)}};q.select("button").on("click",K),i.get(s,rt)&&K()}t.chart=function(){var n,r,i,s,d=window.innerWidth<760,c=function(){var n={};function t(){n={}}return t(),t.setQuestion=function(t){n[t]||(n[t]={})},t.getQuestion=function(t){return n[t]},t.getAllQuestions=function(){return Object.keys(n)},t.getState=function(){return n},t.set=function(t,e,a){n[t][e]||(n[t][e]={}),n[t][e]=a},t.get=function(t,e){return n[t][e]},t}(),t=function(){U.selectAll(".you-draw-it").each(function(t,e){var a=U.select(this),n=this.dataset.key,r=window.ydi_data[n],i=window.ydi_globals,s=r.data.map(function(t,e){return{year:e,timePointIndex:e,timePoint:Object.keys(t)[0],value:t[Object.keys(t)[0]]}}),l=s.map(function(t){return t.timePoint}),o=s.map(function(t){return t.value});c.setQuestion(n),s.length<1?console.log("No data available for:",n):3===e?u(d,c,a,n,r,i,s,l,o):p(d,c,a,n,r,i,s,l,o)})};document.addEventListener("DOMContentLoaded",t),window.addEventListener("resize",(n=function(){t()},r=500,s=void 0,function(){var t=this,e=arguments,a=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||n.apply(t,e)},r),a&&n.apply(t,e)}))},Object.defineProperty(t,"__esModule",{value:!0})});